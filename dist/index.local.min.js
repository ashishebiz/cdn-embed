"use strict";var IdentityVerificationCDN=(()=>{var c=(e,n,t)=>new Promise((o,r)=>{var A=a=>{try{p(t.next(a))}catch(g){r(g)}},b=a=>{try{p(t.throw(a))}catch(g){r(g)}},p=a=>a.done?o(a.value):Promise.resolve(a.value).then(A,b);p((t=t.apply(e,n)).next())});var f="http://localhost:8888",x="/rule-engine/v1/age-app-embedded/generate-qr",y="/rule-engine/v1/age-app-embedded/get-qr";var L="#embed-qr-code",E="#embed-qr-code-logs",S=5e3,m=1e4,i={WaitingForScan:"WaitingForScan",Timeout:"Timeout",Scanned:"Scanned",Approved:"Approved",RejectedByUser:"RejectedByUser",RejectedByRequirement:"RejectedByRequirement",SomethingWentWrong:"SomethingWentWrong"};function R(t){return c(this,arguments,function*(e,n={}){let o=yield fetch(e,{method:"GET",headers:n});if(!o.ok)throw new Error(`HTTP error ${o.status}`);return o.json()})}var v=e=>({Timeout:`
    <div style="margin-bottom: 10px; color: #fff;">QR expired.</div>
    <a id='new-qr-button' style="
      margin-top: 10px;
      display: inline-block;
      padding: 10px 20px;
      background-color: #000;
      border: 1px solid #fff;
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
      cursor:pointer;
    ">New QR</a>
  `,Scanned:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u23F3</div>
    <div style="color: #fff;">Scanning in progress...</div>
  `,Approved:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u2705</div>
    <div style="color: #00ff99;">Access granted in 10s.</div>
  `,RejectedByUser:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u274C</div>
    <div style="color: #ff4444;">Access Denied</div>
  `,RejectedByRequirement:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u274C</div>
    <div style="color: #ff4444;">Access Denied</div>
  `,WaitingForScan:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u{1F4F7}</div>
    <div style="color: #fff;">Waiting for scan...</div>
  `,SomethingWentWrong:`
    <div style="font-size: 30px; margin-bottom: 10px;">\u26A0\uFE0F</div>
    <div style="color: #ff4444;">Something went wrong</div>
  `})[e],T=e=>({Timeout:"QR Expired",Scanned:"Scanning in progress",Approved:"Access Granted",RejectedByUser:"Access Denied",RejectedByRequirement:"Access Denied",WaitingForScan:"Waiting for scan",SomethingWentWrong:"Something went wrong"})[e];var u=e=>document.querySelector(e);function I(e,n){if(!e)return;let t=document.createElement("p");t.innerHTML=T(n),t.style.cssText="margin-bottom:10px;padding:8px;",e.prepend(t)}var d=(...e)=>console.log("[cdn-embed]",...e),s=(...e)=>console.error("[cdn-embed]",...e);var h=(e,n)=>{setTimeout(()=>{window.location.href=e},n)},w=()=>{let e=document.currentScript;return{apiKey:(e==null?void 0:e.dataset.apiKey)||"",successURL:(e==null?void 0:e.dataset.successUrl)||"",failureURL:(e==null?void 0:e.dataset.failureUrl)||"",notificationURL:(e==null?void 0:e.dataset.notificationUrl)||""}};var l=class{constructor(){this.pollingId=null;this.qrContainer=null}configure(n){this.options=n}displayQRCode(n,t){var o;if(this.qrContainer=u(this.options.qrContainerSelector),!this.qrContainer){s("QR Container not found"),this.pollingId&&clearInterval(this.pollingId);return}this.qrContainer.innerHTML=`<div id="qr-code" class="w-100 h-100" style="cursor:pointer;text-align:center;">
      <img src="${n}" alt="QR Code" style="width:100%;height:100%;" /></div>`,(o=document.getElementById("qr-code"))==null||o.addEventListener("click",()=>window.open(t,"_blank"))}startPolling(n){if(this.pollingId&&clearInterval(this.pollingId),!n)throw new Error("Session ID not found");this.pollingId=window.setInterval(()=>c(this,null,function*(){try{let t=`${f}${y}/${n}`,o=yield R(t,{"x-sign-key":this.options.apiKey});I(u(this.options.logContainerSelector||""),o.scanningState),o!=null&&o.scanningState&&this.handleState(o.scanningState)}catch(t){s("Polling error",t),this.handleState(i.Timeout),this.pollingId&&clearInterval(this.pollingId)}}),S)}handleState(n){var r;let t=this.options;t.qrContainerSelector||(s("QR Container not found"),this.pollingId&&clearInterval(this.pollingId));let o=v(n);switch(this.qrContainer&&n!==i.WaitingForScan&&(this.qrContainer.innerHTML=`<div  style="
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        flex-direction: column;
        ">${o}</div>`),n){case i.WaitingForScan:case i.Scanned:break;case i.Approved:t.successRedirectURL&&h(t.successRedirectURL,m);break;case i.Timeout:d(this.options),(r=document.getElementById("new-qr-button"))==null||r.addEventListener("click",()=>this.generateQRCode()),this.pollingId&&clearInterval(this.pollingId);break;case i.SomethingWentWrong:t.failRedirectURL&&h(t.failRedirectURL,m),this.pollingId&&clearInterval(this.pollingId);case i.RejectedByUser:case i.RejectedByRequirement:default:s("Invalid state:",n),this.pollingId&&clearInterval(this.pollingId);break}}generateQRCode(){return c(this,null,function*(){let n="/e42cb048-4a64-4826-af03-5e7eb3a9fa9c";try{let t=`${f}${x}/${n}`,o=yield R(t,{"x-sign-key":this.options.apiKey});this.displayQRCode(o.qrCodeUrl,o.deepLink),this.startPolling(o.sessionId)}catch(t){s("Failed to generate QR code:",t)}})}};(()=>{let{apiKey:e,successURL:n,failureURL:t,notificationURL:o}=w();if(d({apiKey:e,successURL:n,failureURL:t,notificationURL:o}),!e)return s("Missing 'apiKey' in script tag. Example usage: <script src='...main.js data-api-key=your-api-key'>");let r=new l;r.configure({apiKey:e,qrContainerSelector:L,logContainerSelector:E,successRedirectURL:n,failRedirectURL:t}),r.generateQRCode()})();})();
