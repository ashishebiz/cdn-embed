"use strict";(()=>{var w=Object.defineProperty;var S=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var T=(i,t,e)=>t in i?w(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,y=(i,t)=>{for(var e in t||(t={}))V.call(t,e)&&T(i,e,t[e]);if(S)for(var e of S(t))C.call(t,e)&&T(i,e,t[e]);return i};var l=(i,t,e)=>new Promise((r,a)=>{var d=c=>{try{p(e.next(c))}catch(g){a(g)}},o=c=>{try{p(e.throw(c))}catch(g){a(g)}},p=c=>c.done?r(c.value):Promise.resolve(c.value).then(d,o);p((e=e.apply(i,t)).next())});function v(e){return l(this,arguments,function*(i,t={}){return(yield fetch(i,{method:"GET",headers:t})).json()})}function h(r,a){return l(this,arguments,function*(i,t,e={}){let d=yield fetch(i,{method:"POST",headers:y({"Content-Type":"application/json"},e),body:JSON.stringify(t)});if(!d.ok)throw new Error(`HTTP error ${d.status}`);return d.json()})}var E="https://develop-api.chainit.online",L="/users/v1/age-verification";var A=1e4,m=1e4,s={WaitingForScan:"WaitingForScan",Timeout:"Timeout",Scanned:"Scanned",Approved:"Approved",RejectedByUser:"RejectedByUser",RejectedByRequirement:"RejectedByRequirement"};var f=i=>document.querySelector(i);function x(i,t){if(!i)return;let e=document.createElement("div");e.innerText=JSON.stringify(t,null,2),i.prepend(e)}var R=(i,t)=>{setTimeout(()=>{window.location.href=i},t)},U=()=>{let i=document.currentScript;console.log("\u{1F680} ~ script 001",i);let t=(i==null?void 0:i.src)||"";console.log(new URL(t));let e=new URL(t).searchParams;return{apiKey:e.get("apiKey")||"",successURL:e.get("successURL")||"",failureURL:e.get("failureURL")||"",notificationURL:e.get("notificationURL")||""}};var u=class{constructor(){this.pollingId=null}configure(t){this.options=t}displayQRCode(t,e){var a;let r=f(this.options.qrContainerSelector);r&&(r.innerHTML=`<div id="qr-code" class="w-100 h-100" style="cursor:pointer;text-align:center;">
      <img src="${t}" alt="QR Code" style="width:100%;height:100%;" /></div>`,(a=document.getElementById("qr-code"))==null||a.addEventListener("click",()=>window.open(e,"_blank")))}startPolling(t){this.pollingId&&clearInterval(this.pollingId),this.pollingId=window.setInterval(()=>l(this,null,function*(){try{let e=yield v(t,{"x-api-key":this.options.apiKey});x(f(this.options.logContainerSelector||""),e),e!=null&&e.scanningState&&this.handleState(e.scanningState)}catch(e){console.error("Polling error",e),this.handleState("Timeout")}}),A)}handleState(t){let e=this.options;switch(t){case s.Scanned:return e.onVerificationScanning();case s.Approved:return e.onVerificationSuccess();case s.RejectedByUser:return e.onVerificationRejectedByUser();case s.RejectedByRequirement:return e.onVerificationRejectedByRequirements();case s.Timeout:return e.onVerificationTimeout();default:return e.onVerificationFailure()}}generateQRCode(){return l(this,null,function*(){try{let t=`${this.options.apiBaseUrl||E}${L}`,e=yield h(t,{},{"x-api-key":this.options.apiKey});this.displayQRCode(e.qrCodeUrl,e.deepLink),this.startPolling(e.qrCodeStatusCheckUrl)}catch(t){console.error("Failed to generate QR code:",t)}})}};var q=i=>({Timeout:"<div class='message'>QR expired.</div><a id='new-qr-button' class='button secondary'>New QR</a>",Scanned:"<div class='spinner'></div><div class='message'>Scanning in progress...</div>",Approved:"<div class='checkmark'></div><div class='message'>Access granted in 10s.</div>",RejectedByUser:"<div class='cross'></div><div class='message denied'>Access Denied</div>",RejectedByRequirement:"<div class='cross'></div><div class='message denied'>Access Denied</div>",WaitingForScan:""})[i];var n=(()=>{let i=null,t,e="",r="";function a(o){i=document.querySelector(o.qrCodeSelector),i&&(t=o.generateQRCodeFunction,e=o.successRedirectURL||"",r=o.failRedirectURL||"")}function d(o){var c;if(!i)return;let p=q(o);i.innerHTML=`<div class='w-100 h-100 align-content-center'>${p}</div>`,o===s.Timeout&&t&&((c=document.getElementById("new-qr-button"))==null||c.addEventListener("click",t)),o===s.Approved&&e&&R(e,m),(o===s.RejectedByUser||o===s.RejectedByRequirement)&&r&&R(r,m)}return{setOptions:a,handleState:d,STATES:s}})();(()=>{let{apiKey:i,successURL:t,failureURL:e}=U();if(console.log("\u{1F680} ~ apiKey, successURL, failureURL 001",i,t,e),!i)return console.error("Missing apiKey");let r=new u;r.configure({apiKey:i,qrContainerSelector:"#bit-age-verification-qr",logContainerSelector:"#bit-age-verification-logs",onVerificationSuccess:()=>n.handleState(n.STATES.Approved),onVerificationFailure:()=>n.handleState(n.STATES.Timeout),onVerificationScanning:()=>n.handleState(n.STATES.Scanned),onVerificationRejectedByUser:()=>n.handleState(n.STATES.RejectedByUser),onVerificationRejectedByRequirements:()=>n.handleState(n.STATES.RejectedByRequirement),onVerificationTimeout:()=>n.handleState(n.STATES.Timeout)}),r.generateQRCode(),n.setOptions({qrCodeSelector:"#bit-age-verification-qr",generateQRCodeFunction:()=>r.generateQRCode(),successRedirectURL:t,failRedirectURL:e})})();})();
